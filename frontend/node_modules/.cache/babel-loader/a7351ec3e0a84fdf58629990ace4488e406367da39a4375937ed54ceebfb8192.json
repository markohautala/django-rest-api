{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\marko\\\\Desktop\\\\VS CODE\\\\django-rest-api\\\\frontend\\\\src\\\\context\\\\CurrentUserContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$();\nimport { createContext, useContext, useEffect, useMemo, useState } from \"react\";\nimport axios from \"axios\";\nimport { axiosReq, axiosRes } from \"../api/axiosDefaults\";\nimport { useNavigate } from 'react-router-dom';\nimport { removeTokenTimestamp, shouldRefreshToken } from \"../utils/utils\";\n\n// Create contexts to store the current user and provide a way to update it\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const CurrentUserContext = /*#__PURE__*/createContext();\nexport const SetCurrentUserContext = /*#__PURE__*/createContext();\n\n// Custom hooks to easily access the current user and set user contexts\nexport const useCurrentUser = () => {\n  _s();\n  return useContext(CurrentUserContext);\n};\n_s(useCurrentUser, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport const useSetCurrentUser = () => {\n  _s2();\n  return useContext(SetCurrentUserContext);\n};\n_s2(useSetCurrentUser, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport const CurrentUserProvider = ({\n  children\n}) => {\n  _s3();\n  // State to hold the current user information\n  const [currentUser, setCurrentUser] = useState(null);\n  const navigate = useNavigate();\n\n  // Function to fetch the current user information on component mount\n  const handleMount = async () => {\n    try {\n      const {\n        data\n      } = await axiosRes.get(\"dj-rest-auth/user/\");\n      setCurrentUser(data); // Set the current user state with fetched data\n    } catch (err) {\n      // Handle errors silently (could add error handling here if needed)\n    }\n  };\n\n  // useEffect to run the handleMount function when the component mounts\n  useEffect(() => {\n    handleMount();\n  }, []);\n\n  // useMemo to set up axios interceptors that handle token refresh and error responses\n  useMemo(() => {\n    // Request interceptor to refresh the token if needed before making requests\n    axiosReq.interceptors.request.use(async config => {\n      if (shouldRefreshToken()) {\n        try {\n          await axios.post(\"/dj-rest-auth/token/refresh/\"); // Refresh the token if needed\n        } catch (err) {\n          setCurrentUser(null); // If refresh fails, clear the current user\n          navigate(\"/signin\"); // Redirect to the sign-in page\n          removeTokenTimestamp(); // Clear token timestamp\n          return config;\n        }\n      }\n      return config; // Proceed with the request\n    }, err => Promise.reject(err));\n\n    // Response interceptor to handle unauthorized responses\n    axiosRes.interceptors.response.use(response => response, async err => {\n      var _err$response;\n      if (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status) === 401) {\n        // If the error is 401 (Unauthorized)\n        try {\n          await axios.post(\"/dj-rest-auth/token/refresh/\"); // Attempt to refresh the token\n        } catch (err) {\n          setCurrentUser(null); // If refresh fails, clear the current user\n          navigate(\"/signin\"); // Redirect to the sign-in page\n          removeTokenTimestamp(); // Clear token timestamp\n        }\n        return axios(err.config); // Retry the original request with the refreshed token\n      }\n      return Promise.reject(err); // For other errors, just reject the promise\n    });\n  }, [navigate]); // Re-run this effect when `navigate` changes\n\n  // Return the provider components to wrap the application or parts of it with user context\n  return /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n    value: currentUser,\n    children: /*#__PURE__*/_jsxDEV(SetCurrentUserContext.Provider, {\n      value: setCurrentUser,\n      children: [children, \" \"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 76,\n    columnNumber: 5\n  }, this);\n};\n_s3(CurrentUserProvider, \"35ji9CTCGaTzqq7y5vHsqrjfY/c=\", false, function () {\n  return [useNavigate];\n});\n_c = CurrentUserProvider;\nvar _c;\n$RefreshReg$(_c, \"CurrentUserProvider\");","map":{"version":3,"names":["createContext","useContext","useEffect","useMemo","useState","axios","axiosReq","axiosRes","useNavigate","removeTokenTimestamp","shouldRefreshToken","jsxDEV","_jsxDEV","CurrentUserContext","SetCurrentUserContext","useCurrentUser","_s","useSetCurrentUser","_s2","CurrentUserProvider","children","_s3","currentUser","setCurrentUser","navigate","handleMount","data","get","err","interceptors","request","use","config","post","Promise","reject","response","_err$response","status","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/marko/Desktop/VS CODE/django-rest-api/frontend/src/context/CurrentUserContext.js"],"sourcesContent":["import { createContext, useContext, useEffect, useMemo, useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport { axiosReq, axiosRes } from \"../api/axiosDefaults\";\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { removeTokenTimestamp, shouldRefreshToken } from \"../utils/utils\";\r\n\r\n// Create contexts to store the current user and provide a way to update it\r\nexport const CurrentUserContext = createContext();\r\nexport const SetCurrentUserContext = createContext();\r\n\r\n// Custom hooks to easily access the current user and set user contexts\r\nexport const useCurrentUser = () => useContext(CurrentUserContext);\r\nexport const useSetCurrentUser = () => useContext(SetCurrentUserContext);\r\n\r\nexport const CurrentUserProvider = ({ children }) => {\r\n  // State to hold the current user information\r\n  const [currentUser, setCurrentUser] = useState(null);\r\n  const navigate = useNavigate();\r\n\r\n  // Function to fetch the current user information on component mount\r\n  const handleMount = async () => {\r\n    try {\r\n      const { data } = await axiosRes.get(\"dj-rest-auth/user/\");\r\n      setCurrentUser(data); // Set the current user state with fetched data\r\n    } catch (err) {\r\n      // Handle errors silently (could add error handling here if needed)\r\n    }\r\n  };\r\n\r\n  // useEffect to run the handleMount function when the component mounts\r\n  useEffect(() => {\r\n    handleMount();\r\n  }, []);\r\n\r\n  // useMemo to set up axios interceptors that handle token refresh and error responses\r\n  useMemo(() => {\r\n    // Request interceptor to refresh the token if needed before making requests\r\n    axiosReq.interceptors.request.use(\r\n      async (config) => {\r\n        if (shouldRefreshToken()) {\r\n          try {\r\n            await axios.post(\"/dj-rest-auth/token/refresh/\"); // Refresh the token if needed\r\n          } catch (err) {\r\n            setCurrentUser(null); // If refresh fails, clear the current user\r\n            navigate(\"/signin\"); // Redirect to the sign-in page\r\n            removeTokenTimestamp(); // Clear token timestamp\r\n            return config;\r\n          }\r\n        }\r\n        return config; // Proceed with the request\r\n      },\r\n      (err) => Promise.reject(err)\r\n    );\r\n\r\n    // Response interceptor to handle unauthorized responses\r\n    axiosRes.interceptors.response.use(\r\n      (response) => response,\r\n      async (err) => {\r\n        if (err.response?.status === 401) { // If the error is 401 (Unauthorized)\r\n          try {\r\n            await axios.post(\"/dj-rest-auth/token/refresh/\"); // Attempt to refresh the token\r\n          } catch (err) {\r\n            setCurrentUser(null); // If refresh fails, clear the current user\r\n            navigate(\"/signin\"); // Redirect to the sign-in page\r\n            removeTokenTimestamp(); // Clear token timestamp\r\n          }\r\n          return axios(err.config); // Retry the original request with the refreshed token\r\n        }\r\n        return Promise.reject(err); // For other errors, just reject the promise\r\n      }\r\n    );\r\n  }, [navigate]); // Re-run this effect when `navigate` changes\r\n\r\n  // Return the provider components to wrap the application or parts of it with user context\r\n  return (\r\n    <CurrentUserContext.Provider value={currentUser}>\r\n      <SetCurrentUserContext.Provider value={setCurrentUser}>\r\n        {children} {/* Render any child components that need access to this context */}\r\n      </SetCurrentUserContext.Provider>\r\n    </CurrentUserContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}